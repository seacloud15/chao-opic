<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•™ìŠµ ìë£Œ ê´€ë¦¬ - ChaoOPIc</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .manager-container {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
        }
        .status-card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .status-card h2 {
            color: #1565c0;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e65100;
        }
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #1565c0;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #f57c00;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .success-box {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-item {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-item .label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 8px;
        }
        .stat-item .value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #1565c0;
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .btn {
            padding: 12px 24px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }
        .btn-primary {
            background: #1565c0;
            color: white;
        }
        .btn-primary:hover {
            background: #0d47a1;
        }
        .btn-secondary {
            background: #e65100;
            color: white;
        }
        .btn-secondary:hover {
            background: #bf360c;
        }
        .btn-danger {
            background: #d32f2f;
            color: white;
        }
        .btn-danger:hover {
            background: #b71c1c;
        }
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .hidden {
            display: none;
        }
        .folder-path {
            font-family: monospace;
            background: #f5f5f5;
            padding: 8px 12px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1 class="logo"><a href="index.html">ChaoOPIc</a></h1>
            <nav class="nav-links"></nav>
        </div>
    </header>

    <main class="page-content">
        <div class="manager-container">
            <div class="status-card">
                <h2>ğŸ—‚ï¸ í•™ìŠµ ìë£Œ ê´€ë¦¬</h2>

                <!-- ë¸Œë¼ìš°ì € ì§€ì› ì•ˆë‚´ -->
                <div id="notSupported" class="warning-box hidden">
                    <strong>âš ï¸ ë¸Œë¼ìš°ì € ë¯¸ì§€ì›</strong><br>
                    ì´ ê¸°ëŠ¥ì€ Chrome, Edge ë“± ìµœì‹  ë¸Œë¼ìš°ì €ì—ì„œë§Œ ì§€ì›ë©ë‹ˆë‹¤.<br>
                    File System Access APIê°€ ì§€ì›ë˜ëŠ” ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.
                </div>

                <!-- ìºì‹œ ì—†ìŒ ìƒíƒœ -->
                <div id="noCache" class="hidden">
                    <div class="info-box">
                        <strong>ğŸ“‚ ì˜¤ë””ì˜¤ íŒŒì¼ ì¸ë±ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤</strong><br>
                        ì‹œë®¬ë ˆì´ì…˜ì„ ì‚¬ìš©í•˜ë ¤ë©´ ë¨¼ì € ì˜¤ë””ì˜¤ íŒŒì¼ì´ ìˆëŠ” <code>audio/simulation</code> í´ë”ë¥¼ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.
                    </div>

                    <p><strong>ğŸ“ í´ë” êµ¬ì¡° ì˜ˆì‹œ:</strong></p>
                    <div class="folder-path">
                        audio/simulation/<br>
                        â”œâ”€â”€ self-introduction/<br>
                        â”œâ”€â”€ selfAssess/<br>
                        â”œâ”€â”€ survey/<br>
                        â”‚   â”œâ”€â”€ ì˜í™”ë³´ê¸°_01/<br>
                        â”‚   â”œâ”€â”€ ê³µì›ê°€ê¸°_01/<br>
                        â”‚   â””â”€â”€ ...<br>
                        â”œâ”€â”€ non-survey/<br>
                        â”œâ”€â”€ rolePlay/<br>
                        â””â”€â”€ issueComparison/
                    </div>

                    <div class="button-group">
                        <button id="btnSelectFolder" class="btn btn-primary">
                            ğŸ“ ì˜¤ë””ì˜¤ í´ë” ì„ íƒ ë° ìŠ¤ìº”
                        </button>
                    </div>
                </div>

                <!-- ìºì‹œ ìˆìŒ ìƒíƒœ -->
                <div id="hasCache" class="hidden">
                    <div class="success-box">
                        <strong>âœ… ì˜¤ë””ì˜¤ ì¸ë±ìŠ¤ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤</strong><br>
                        ì‹œë®¬ë ˆì´ì…˜ì—ì„œ ì •ìƒì ìœ¼ë¡œ ë¬¸ì œë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </div>

                    <h3>ğŸ“Š ì¸ë±ìŠ¤ í†µê³„</h3>
                    <div class="stats-grid" id="statsGrid"></div>

                    <div class="button-group">
                        <button id="btnRescan" class="btn btn-secondary">
                            ğŸ”„ ë‹¤ì‹œ ìŠ¤ìº”
                        </button>
                        <button id="btnClearCache" class="btn btn-danger">
                            ğŸ—‘ï¸ ìºì‹œ ì‚­ì œ
                        </button>
                    </div>
                </div>

                <!-- ìŠ¤ìº” ì¤‘ ìƒíƒœ -->
                <div id="scanning" class="hidden">
                    <div class="info-box">
                        <strong><span class="spinner"></span> í´ë” ìŠ¤ìº” ì¤‘...</strong><br>
                        ì˜¤ë””ì˜¤ íŒŒì¼ì„ ê²€ìƒ‰í•˜ê³  ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.
                    </div>
                </div>
            </div>

            <!-- ì‚¬ìš© ì•ˆë‚´ -->
            <div class="status-card">
                <h2>ğŸ’¡ ì‚¬ìš© ì•ˆë‚´</h2>
                <ol style="line-height: 1.8;">
                    <li><strong>í´ë” ì„ íƒ:</strong> "ì˜¤ë””ì˜¤ í´ë” ì„ íƒ ë° ìŠ¤ìº”" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ <code>audio/simulation</code> í´ë”ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.</li>
                    <li><strong>ìë™ ìŠ¤ìº”:</strong> ì„ íƒí•œ í´ë” ë‚´ì˜ ëª¨ë“  ì˜¤ë””ì˜¤ íŒŒì¼ì„ ìë™ìœ¼ë¡œ ìŠ¤ìº”í•˜ì—¬ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</li>
                    <li><strong>ìºì‹œ ì €ì¥:</strong> ìƒì„±ëœ ì¸ë±ìŠ¤ëŠ” ë¸Œë¼ìš°ì €ì˜ localStorageì— ì €ì¥ë˜ì–´ ë‹¤ìŒë²ˆì— ë‹¤ì‹œ ì„ íƒí•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.</li>
                    <li><strong>ì‹œë®¬ë ˆì´ì…˜ ì‚¬ìš©:</strong> ì¸ë±ìŠ¤ê°€ ì¤€ë¹„ë˜ë©´ "ì˜¤í”½ ì‹œë®¬ë ˆì´ì…˜" í˜ì´ì§€ì—ì„œ ì •ìƒì ìœ¼ë¡œ ë¬¸ì œë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                    <li><strong>íŒŒì¼ ë³€ê²½ ì‹œ:</strong> ì˜¤ë””ì˜¤ íŒŒì¼ì„ ì¶”ê°€/ì‚­ì œ/ë³€ê²½í•œ ê²½ìš° "ë‹¤ì‹œ ìŠ¤ìº”" ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¸ë±ìŠ¤ë¥¼ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”.</li>
                </ol>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2026 ChaoOPIc v1.0.0</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="js/core/app.js"></script>
    <script src="js/core/storage.js"></script>
    <script src="js/core/audio.js"></script>
    <script src="js/core/timer.js"></script>
    <script src="js/core/ui.js"></script>
    <script src="js/core/audioIndexManager.js"></script>

    <script>
        (function() {
            'use strict';

            var ui = ChaoOPIc.core.ui;
            var manager = ChaoOPIc.core.audioIndexManager;

            // DOM ìš”ì†Œ
            var notSupported = ui.$('#notSupported');
            var noCache = ui.$('#noCache');
            var hasCache = ui.$('#hasCache');
            var scanning = ui.$('#scanning');
            var statsGrid = ui.$('#statsGrid');
            var btnSelectFolder = ui.$('#btnSelectFolder');
            var btnRescan = ui.$('#btnRescan');
            var btnClearCache = ui.$('#btnClearCache');

            /**
             * UI ìƒíƒœ ì—…ë°ì´íŠ¸
             */
            function updateUI() {
                // ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
                notSupported.classList.add('hidden');
                noCache.classList.add('hidden');
                hasCache.classList.add('hidden');
                scanning.classList.add('hidden');

                // ë¸Œë¼ìš°ì € ì§€ì› í™•ì¸
                if (!manager.isSupported()) {
                    notSupported.classList.remove('hidden');
                    return;
                }

                // ìºì‹œ í™•ì¸
                if (manager.hasCache()) {
                    hasCache.classList.remove('hidden');
                    renderStats();
                } else {
                    noCache.classList.remove('hidden');
                }
            }

            /**
             * í†µê³„ ë Œë”ë§
             */
            function renderStats() {
                var stats = manager.getStats();
                if (!stats) {
                    return;
                }

                statsGrid.innerHTML = '';

                var items = [
                    { label: 'Survey ì£¼ì œ', value: stats.survey, scripts: stats.surveyScripts },
                    { label: 'Non-Survey ì£¼ì œ', value: stats.nonSurvey, scripts: stats.nonSurveyScripts },
                    { label: 'RolePlay ì£¼ì œ', value: stats.rolePlay, scripts: stats.rolePlayScripts },
                    { label: 'Issue Comparison ì£¼ì œ', value: stats.issueComparison, scripts: stats.issueComparisonScripts }
                ];

                items.forEach(function(item) {
                    var div = document.createElement('div');
                    div.className = 'stat-item';
                    div.innerHTML = '<div class="label">' + item.label + '</div>' +
                                    '<div class="value">' + item.value + '</div>' +
                                    '<div class="label" style="font-size:0.8rem;margin-top:4px;">ìŠ¤í¬ë¦½íŠ¸: ' + item.scripts + 'ê°œ</div>';
                    statsGrid.appendChild(div);
                });
            }

            /**
             * í´ë” ì„ íƒ ë° ìŠ¤ìº”
             */
            async function selectFolder() {
                try {
                    // ìŠ¤ìº” ì¤‘ í‘œì‹œ
                    noCache.classList.add('hidden');
                    hasCache.classList.add('hidden');
                    scanning.classList.remove('hidden');

                    // í´ë” ì„ íƒ ë° ìŠ¤ìº”
                    var index = await manager.selectAndScanFolder();

                    if (index) {
                        // ì„±ê³µ
                        ui.showModal({
                            title: 'âœ… ìŠ¤ìº” ì™„ë£Œ',
                            content: '<p>ì˜¤ë””ì˜¤ íŒŒì¼ ì¸ë±ìŠ¤ê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.</p>' +
                                     '<p>ì´ì œ ì‹œë®¬ë ˆì´ì…˜ í˜ì´ì§€ì—ì„œ ë¬¸ì œë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>',
                            buttons: [{ label: 'í™•ì¸', className: 'btn-primary' }]
                        });
                    }
                } catch (error) {
                    console.error('[audio-manager] Scan error:', error);
                    ui.showModal({
                        title: 'âŒ ìŠ¤ìº” ì‹¤íŒ¨',
                        content: '<p><strong>ì˜¤ë¥˜:</strong> ' + error.message + '</p>' +
                                 '<p>í´ë” êµ¬ì¡°ë¥¼ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>',
                        buttons: [{ label: 'í™•ì¸', className: 'btn-primary' }]
                    });
                } finally {
                    updateUI();
                }
            }

            /**
             * ìºì‹œ ì‚­ì œ
             */
            function clearCache() {
                ui.showModal({
                    title: 'ğŸ—‘ï¸ ìºì‹œ ì‚­ì œ',
                    content: '<p>ì˜¤ë””ì˜¤ ì¸ë±ìŠ¤ ìºì‹œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>' +
                             '<p>ì‚­ì œ í›„ì—ëŠ” ë‹¤ì‹œ í´ë”ë¥¼ ì„ íƒí•˜ê³  ìŠ¤ìº”í•´ì•¼ í•©ë‹ˆë‹¤.</p>',
                    buttons: [
                        {
                            label: 'ì·¨ì†Œ',
                            className: 'btn-secondary',
                            onClick: function() { ui.closeModal(); }
                        },
                        {
                            label: 'ì‚­ì œ',
                            className: 'btn-danger',
                            onClick: function() {
                                manager.clearCache();
                                ui.closeModal();
                                updateUI();
                                ui.showModal({
                                    title: 'âœ… ì‚­ì œ ì™„ë£Œ',
                                    content: '<p>ìºì‹œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.</p>',
                                    buttons: [{ label: 'í™•ì¸', className: 'btn-primary' }]
                                });
                            }
                        }
                    ]
                });
            }

            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            btnSelectFolder.addEventListener('click', selectFolder);
            btnRescan.addEventListener('click', selectFolder);
            btnClearCache.addEventListener('click', clearCache);

            // ë„¤ë¹„ê²Œì´ì…˜ ë Œë”ë§
            ui.renderNav('audio-manager');

            // ì´ˆê¸° UI ì—…ë°ì´íŠ¸
            updateUI();
        })();
    </script>
</body>
</html>
