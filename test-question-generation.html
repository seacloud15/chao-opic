<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Question Generation Test - ChaoOPIc</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        body {
            padding: 40px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-section h2 {
            color: #1565c0;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e65100;
        }
        .survey-form {
            margin: 20px 0;
        }
        .survey-group {
            margin: 20px 0;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
        }
        .survey-group label {
            display: block;
            margin: 8px 0;
            cursor: pointer;
        }
        .questions-list {
            margin-top: 20px;
        }
        .question-item {
            padding: 15px;
            margin: 10px 0;
            background: #e3f2fd;
            border-left: 4px solid #1565c0;
            border-radius: 4px;
        }
        .question-item strong {
            color: #1565c0;
        }
        .folder-info {
            font-size: 13px;
            color: #666;
            margin-top: 5px;
        }
        .error {
            background: #ffebee;
            border-left-color: #c62828;
        }
    </style>
</head>
<body>
    <div class="test-section">
        <h2>ğŸ§ª ë¬¸ì œ ìƒì„± ë¡œì§ í…ŒìŠ¤íŠ¸</h2>

        <div class="survey-form">
            <h3>Mock Survey ì‘ë‹µ</h3>

            <div class="survey-group">
                <strong>Self Assessment Level (ë‚œì´ë„)</strong><br>
                <label><input type="radio" name="level" value="1"> Level 1 (ì´ˆê¸‰)</label>
                <label><input type="radio" name="level" value="2"> Level 2</label>
                <label><input type="radio" name="level" value="3" checked> Level 3 (ì¤‘ê¸‰)</label>
                <label><input type="radio" name="level" value="4"> Level 4</label>
                <label><input type="radio" name="level" value="5"> Level 5 (ê³ ê¸‰)</label>
                <label><input type="radio" name="level" value="6"> Level 6</label>
            </div>

            <div class="survey-group">
                <strong>Part 3: ê±°ì£¼ í˜•íƒœ</strong><br>
                <label>
                    <input type="radio" name="part3" value="ê°œì¸ì£¼íƒì´ë‚˜ ì•„íŒŒíŠ¸ì— í™€ë¡œ ê±°ì£¼" checked>
                    ê°œì¸ì£¼íƒì´ë‚˜ ì•„íŒŒíŠ¸ì— í™€ë¡œ ê±°ì£¼
                </label>
            </div>

            <div class="survey-group">
                <strong>Part 4: ì—¬ê°€/ì·¨ë¯¸/ìš´ë™/íœ´ê°€ (12ê°œ ì´ìƒ ì„ íƒ)</strong><br>
                <label><input type="checkbox" name="part4" value="ì˜í™”ë³´ê¸°" checked> ì˜í™”ë³´ê¸°</label><br>
                <label><input type="checkbox" name="part4" value="ê³µì›ê°€ê¸°" checked> ê³µì›ê°€ê¸°</label><br>
                <label><input type="checkbox" name="part4" value="í•´ë³€ê°€ê¸°" checked> í•´ë³€ê°€ê¸°</label><br>
                <label><input type="checkbox" name="part4" value="ê³µì—°ë³´ê¸°" checked> ê³µì—°ë³´ê¸°</label><br>
                <label><input type="checkbox" name="part4" value="ì½˜ì„œíŠ¸ë³´ê¸°" checked> ì½˜ì„œíŠ¸ë³´ê¸°</label><br>
                <label><input type="checkbox" name="part4" value="ìŒì•… ê°ìƒí•˜ê¸°" checked> ìŒì•… ê°ìƒí•˜ê¸°</label><br>
                <label><input type="checkbox" name="part4" value="ì¡°ê¹…" checked> ì¡°ê¹…</label><br>
                <label><input type="checkbox" name="part4" value="ê±·ê¸°" checked> ê±·ê¸°</label><br>
                <label><input type="checkbox" name="part4" value="êµ­ë‚´ ì—¬í–‰" checked> êµ­ë‚´ ì—¬í–‰</label><br>
                <label><input type="checkbox" name="part4" value="í•´ì™¸ ì—¬í–‰" checked> í•´ì™¸ ì—¬í–‰</label><br>
                <label><input type="checkbox" name="part4" value="ì§‘ì—ì„œ ë³´ë‚´ëŠ” íœ´ê°€" checked> ì§‘ì—ì„œ ë³´ë‚´ëŠ” íœ´ê°€</label><br>
                <label><input type="checkbox" name="part4" value="ìš”ë¦¬í•˜ê¸°" checked> ìš”ë¦¬í•˜ê¸°</label>
            </div>

            <button id="generateBtn" class="btn btn-primary">ë¬¸ì œ ìƒì„± í…ŒìŠ¤íŠ¸</button>
        </div>

        <div id="results" class="questions-list"></div>
    </div>

    <!-- Scripts -->
    <script src="js/core/app.js"></script>
    <script src="js/core/audioIndexManager.js"></script>
    <script src="js/data/simulation/audioFileIndex.js"></script>
    <script src="js/core/fileScanner.js"></script>
    <script src="js/core/questionSelector.js"></script>

    <script>
        var fileScanner = ChaoOPIc.core.fileScanner;
        var questionSelector = ChaoOPIc.core.questionSelector;

        // fileScanner ì´ˆê¸°í™” (localStorage ë˜ëŠ” audioFileIndex.jsì—ì„œ ë¡œë“œ)
        if (!fileScanner.initialize()) {
            console.error('Failed to initialize fileScanner. Please set up audio files in audio-manager.html');
        }

        document.getElementById('generateBtn').addEventListener('click', function() {
            console.clear();
            console.log('=== ë¬¸ì œ ìƒì„± í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');

            // Mock Survey ì‘ë‹µ ìˆ˜ì§‘
            var selfAssessLevel = parseInt(document.querySelector('input[name="level"]:checked').value);
            var part3 = document.querySelector('input[name="part3"]:checked').value;
            var part4Checkboxes = document.querySelectorAll('input[name="part4"]:checked');
            var part4 = [];
            part4Checkboxes.forEach(function(cb) {
                part4.push(cb.value);
            });

            var surveyAnswers = {
                part3: part3,
                part4: part4
            };

            console.log('Survey ì‘ë‹µ:', surveyAnswers);
            console.log('Self Assessment Level:', selfAssessLevel);

            // ===== í´ë” ë§¤ì¹­ í…ŒìŠ¤íŠ¸ =====
            console.log('\n=== 1ë‹¨ê³„: Survey í´ë” ë§¤ì¹­ í…ŒìŠ¤íŠ¸ ===');

            // Part 3 í…ŒìŠ¤íŠ¸
            console.log('\n[Part 3] "' + part3 + '"');
            var part3Folders = fileScanner.findSurveyFolders(part3);
            console.log('â†’ ë°œê²¬ëœ í´ë”:', part3Folders);
            var selectedPart3 = fileScanner.getRandomSurveyFolder(part3);
            console.log('â†’ ì„ íƒëœ í´ë”:', selectedPart3);

            // Part 4 í…ŒìŠ¤íŠ¸
            console.log('\n[Part 4] ì„ íƒëœ í•­ëª©:', part4.length + 'ê°œ');
            part4.forEach(function(answer) {
                var folders = fileScanner.findSurveyFolders(answer);
                var selected = fileScanner.getRandomSurveyFolder(answer);
                console.log('  "' + answer + '" â†’ í´ë” ' + folders.length + 'ê°œ ë°œê²¬, ì„ íƒ: ' + selected);
            });

            // ===== ë¬¸ì œ ìƒì„± í…ŒìŠ¤íŠ¸ =====
            console.log('\n=== 2ë‹¨ê³„: ì „ì²´ ë¬¸ì œ ì„¸íŠ¸ ìƒì„± ===');
            var questions = questionSelector.generate(surveyAnswers, selfAssessLevel);

            console.log('ìƒì„±ëœ ë¬¸ì œ ìˆ˜:', questions.length);
            questionSelector.printSummary(questions);

            // ===== ê²°ê³¼ í‘œì‹œ =====
            var resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<h3>ìƒì„±ëœ ë¬¸ì œ (' + questions.length + 'ê°œ)</h3>';
            resultsDiv.innerHTML += '<p><strong>ë‚œì´ë„:</strong> Level ' + selfAssessLevel + ' | <strong>Q15 íŒŒì¼ ë²ˆí˜¸:</strong> ' + (selfAssessLevel <= 4 ? '6ë²ˆ' : '5ë²ˆ') + '</p>';

            if (questions.length < 15) {
                resultsDiv.innerHTML += '<div class="question-item error"><strong>âš ï¸ ê²½ê³ :</strong> 15ê°œ ë¬¸ì œê°€ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!</div>';
            }

            questions.forEach(function(q) {
                var div = document.createElement('div');
                div.className = 'question-item';

                var html = '<strong>Q' + q.number + '</strong> [' + q.category + ']<br>';
                html += '<strong>Topic:</strong> ' + q.topic + '<br>';
                html += '<strong>Text:</strong> ' + q.text;

                if (q.audio) {
                    html += '<div class="folder-info">ğŸ“ ' + q.audio + '</div>';
                } else {
                    div.className += ' error';
                    html += '<div class="folder-info">âŒ ì˜¤ë””ì˜¤ íŒŒì¼ ì—†ìŒ!</div>';
                }

                div.innerHTML = html;
                resultsDiv.appendChild(div);
            });

            console.log('=== í…ŒìŠ¤íŠ¸ ì™„ë£Œ ===');
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ fileScanner í†µê³„ ì¶œë ¥
        window.addEventListener('DOMContentLoaded', function() {
            console.log('=== audioFileIndex í†µê³„ ===');
            fileScanner.printStats();

            // Survey ë‹µë³€ ìƒ˜í”Œë¡œ í´ë” ê²€ìƒ‰ í…ŒìŠ¤íŠ¸
            console.log('\n=== í´ë” ê²€ìƒ‰ í…ŒìŠ¤íŠ¸ ===');
            var testAnswers = ['ê³µì›ê°€ê¸°', 'ì˜í™”ë³´ê¸°', 'ìŒì•… ê°ìƒí•˜ê¸°', 'í•´ì™¸ ì—¬í–‰'];
            testAnswers.forEach(function(answer) {
                var folders = fileScanner.findSurveyFolders(answer);
                console.log('"' + answer + '" â†’ ' + folders.length + 'ê°œ í´ë”:', folders);
            });
        });
    </script>
</body>
</html>
